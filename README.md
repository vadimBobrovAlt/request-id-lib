# Библиотека Request ID

Эта библиотека предоставляет функциональность для работы с `Request ID` для входящих HTTP-запросов. Она гарантирует, что каждый запрос будет иметь уникальный идентификатор, который либо передается клиентом, либо генерируется на сервере. `Request ID` включается как в заголовки запроса, так и в заголовки ответа, а также добавляется в контекст логирования для удобства отслеживания.

## Основные возможности

- Автоматическая генерация или сохранение `Request ID` для каждого входящего запроса.
- Добавление `Request ID` в заголовки запроса и ответа.
- Передача `Request ID` в контексте логирования для отслеживания запросов.
- Простой хелпер для получения `Request ID` с возможностью добавления префикса.

## Установка

Для установки библиотеки добавьте её в ваш проект через Composer:

```bash
composer require bobrovva/request_id_lib
```

## Использование

### 1. Использование `RequestHelper`

Класс `RequestHelper` позволяет легко получить или сгенерировать `Request ID` для текущего запроса. Вы можете опционально передать префикс для идентификатора.

#### Пример использования:

```php
use app\helpers\RequestHelper;

// Получение или генерация Request ID с префиксом
$requestId = RequestHelper::requestId('prefix-');
echo $requestId; // Пример вывода: 'prefix-123e4567-e89b-12d3-a456-426614174000'
```

### 2. Использование `RequestIdMiddleware`

Мидлвэр `RequestIdMiddleware` автоматически обрабатывает установку `Request ID` в заголовках запроса и ответа. Также он добавляет `Request ID` в контекст логирования для отслеживания запросов.

#### Пример регистрации мидлвэра:

В файле `bootstrap/app.php` зарегистрируйте мидлвэр для применения ко всем запросам:

```php
    ->withMiddleware(function (Middleware $middleware) {
        $middleware->use([
            RequestIdMiddleware::class
        ]);

    })
```

### Логика работы мидлвэра

Мидлвэр выполняет следующие действия:
- Проверяет наличие заголовка `X-Request-ID` во входящем запросе. Если заголовок отсутствует, генерируется новый UUID.
- Устанавливает `X-Request-ID` в заголовки запроса, чтобы другие мидлвэры или контроллеры могли его использовать.
- Логирует `Request ID` для удобства отслеживания.
- Добавляет `X-Request-ID` в заголовки ответа, чтобы идентификатор возвращался клиенту.

#### Пример использования мидлвэра:

После регистрации мидлвэр автоматически применяется ко всем запросам. Ниже приведен пример запроса и ответа:

#### Входящий запрос (без `X-Request-ID`):
```bash
GET /example HTTP/1.1
Host: example.com
```

#### Ответ:
```bash
HTTP/1.1 200 OK
X-Request-ID: 123e4567-e89b-12d3-a456-426614174000
```

#### Входящий запрос (с `X-Request-ID`):
```bash
GET /example HTTP/1.1
Host: example.com
X-Request-ID: abcd-efgh-ijkl-mnop
```

#### Ответ:
```bash
HTTP/1.1 200 OK
X-Request-ID: abcd-efgh-ijkl-mnop
```

### Логирование с `Request ID`

Мидлвэр добавляет `Request ID` в контекст логирования, что позволяет отслеживать логи, связанные с конкретным запросом. Это удобно для поиска проблем и отладки. Пример записи в логе:

```
[2024-09-19 10:00:00] local.INFO: Обработка запроса... {"request-id":"123e4567-e89b-12d3-a456-426614174000"}
```

## Заключение

Эта библиотека упрощает работу с `Request ID` в вашем приложении, предоставляя унифицированный способ отслеживания и логирования запросов.